CREATE EXTENSION vector;

CReATE TABLE models_types (
  id SMALLINT GENERATED ALWAYS AS IDENTITY,
  name VARCHAR(30) NOT NULL,

  PRIMARY KEY(id)
);

CREATE TABLE agents (
  id BIGINT GENERATED ALWAYS AS IDENTITY,
  type_id SMALLINT NOT NULL,
  model_id BIGINT NOT NULL,
  data VARCHAR(255) NOT NULL,
  path TEXT NOT NULL,
  end_of_line BIGINT,
  asl_file_path VARCHAR(255) NOT NULL DEFAULT '',
  processed BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

  PRIMARY KEY(id),
  CONSTRAINT fk_type_id FOREIGN KEY(type_id) REFERENCES models_types(id),
  CONSTRAINT fk_model_id FOREIGN KEY(model_id) REFERENCES models(id)
);

CREATE TABLE models (
  id BIGINT GENERATED ALWAYS AS IDENTITY,
  name VARCHAR(255) NOT NULL
);

INSERT INTO models (name) VALUES ('m1'), ('m2');
INSERT INTO models_types (name) VALUES ('netlogo');

CREATE TABLE m1 (
  id BIGSERIAL PRIMARY KEY,
  agent_id INTEGER NOT NULL,
  data VARCHAR(255) NOT NULL,
  path TEXT NOT NULL,
  asl_file_path VARCHAR(255) NOT NULL DEFAULT '',
  processed BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE m2 (
  id BIGSERIAL PRIMARY KEY,
  agent_id INTEGER NOT NULL,
  data VARCHAR(255) NOT NULL,
  path TEXT NOT NULL,
  asl_file_path VARCHAR(255) NOT NULL DEFAULT '',
  processed BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE m3 (
  id BIGSERIAL PRIMARY KEY,
  agent_id INTEGER NOT NULL,
  data VARCHAR(255) NOT NULL,
  path TEXT NOT NULL,
  asl_file_path VARCHAR(255) NOT NULL DEFAULT '',
  processed BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE alive_agents (
  id BIGSERIAL PRIMARY KEY,
  agent_id INTEGER NOT NULL,
  model VARCHAR(255) NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE router (
  id BIGSERIAL PRIMARY KEY,
  agent_id INTEGER NOT NULL,
  data VARCHAR(255) NOT NULL,
  path TEXT NOT NULL,
  asl_file_path VARCHAR(255) NOT NULL DEFAULT '',
  processed BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
